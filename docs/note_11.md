# Background About AJAX & Web 

이 스터디 노트에서는 React 에서 AJAX 를 사용하기 위한 대략적인 메카니즘을 깨닫는 시간을 가지겠습니다.

참고로 AJAX 를 이용해서 데이터를 가져오고 보여주는 과정은 쉽습니다. 

하지만 메카니즘이 어떻게 돌아가는지에 대해 생각을 못 하면 공부 안 한 것 보다 더 못 합니다.

## What Is AJAX?

AJAX (Asynchronous JavaScript And XML) 는 JavaScript 로 작성한 문장 중에서 사용자가 원하는 요청을 불러온 후 이에 대한 렌더링을 거치는 과정입니다.

과거에는 XML 문장으로 요청을 받았지만, 요즘은 JSON 포맷을 이용합니다. JSON 은 객체가 가지고 있는 멤버들을 자바스크립트로 작성하는 기법입니다.

```js
{
    'name' : '강사람',
    'age' : 25
}
```

**How To Use AJAX?**

JavaScript 를 이용하는 환경에서 AJAX 요청을 하는 방법은 2가지가 있는데, `fetch()` 함수를 이용하는 방법과 `axios` 라이브러리를 활용하는 것입니다.

`axios` 모듈은 HTTP 통신에 대한 전반적인 처리 과정을 손쉽게 이용하게끔 도와줍니다. `axios` 라이브러리는 아래와 같은 명령어로 손쉽게 설치할 수 있습니다.

```
npm install axios
```

그리고 바닐라 자바스크립트(그니깐 순수, Only, 아무 것도 의존 되지 않은 자바스크립트) 에서는 `fetch()` 함수를 이용하는데 여기서 AJAX 를 사용하기 위해 Promise 개념에 대해 알아야 합니다. 이 개념은 다음 스터디 노트에서 다루겠습니다.

그리고 jQuery 자체에서도 AJAX 를 사용하도록 제공합니다. jQuery 에서 유일하게 좋은 평을 듣기는 하지만, 이를 이용하기 위해 jQuery 를 불러 올 수는 없어서 `axios` 라이브러리가 생겨난 듯 합니다.

## HTTP Request Mechanism

우선 AJAX 를 사용하는 방법을 공부하기 앞서 Web 화면을 불러오고 HTML 화면에 보여지는 과정을 자세히 알아볼 필요가 있습니다. 아래 링크에 있는 글을 참조했습니다.

[Mozilla Web 참조](https://developer.mozilla.org/ko/docs/Learn/Getting_started_with_the_web/%EC%9B%B9%EC%9D%98_%EB%8F%99%EC%9E%91_%EB%B0%A9%EC%8B%9D)

여기서는 어느 디바이스(스마트폰, 노트북, 컴퓨터 등) 에서 웹 페이지를 볼 때 어떤 과정들이 일어나는지 자세히 살펴보기 위해 작성했습니다.

Web 브라우저를 이용해 Web 페이지를 참조하는 디바이스는 클라이언트(Client) 입니다. 그리고 이를 제공하기 위한 정적 페이지, 데이터베이스, 클라우드 등의 기능을 묶어둔 주체가 서버(Server) 입니다.

클라이언트는 서버에게 응답(Response) 을 받고, 그 때마다 필요한 것들에 대해 서버한테 요청(Request) 을 합니다.

그 중에서 요청(Request) 과정이 일어날 때 HTTP 를 기반으로 상세한 과정을 정리하면 아래와 같습니다.

1. 사용자가 입력한 URL 에 대해 DNS 서버를 이용해 실제 웹 서비스를 제공하는 IP 주소를 찾습니다.

2. 주소를 찾으면 브라우저는 정적 웹 페이지(사본 페이지. 유사 시 대비용으로 이해하면 좋겠습니다.) 를 클라이언트에게 보내달라고 요청을 합니다. HTML 의 용량은 그렇게 큰 편이 아니기 때문에 순식간에 받을 수 있습니다.

3. 웹 페이지를 클라이언트 측에서 받으면 CSS, JavaScript, 이미지 등의 정적 파일을 요청합니다.

- 이 파일들은 로컬 디스크의 캐시에 저장이 되고(물론 HTML 파일도 마찬가지.) HTML 에 있는 DOM 트리에 따라 CSS 를 입혀 보기 좋은 디자인으로 반환합니다. 

- 용량이 큰 이미지 파일, 미디어 파일 등은 웹 사이트에 대한 렌더링에 많은 영향을 주기 때문에 Webpack 등의 보일러 플레이트로 압축해서 제공하는 방법을 고려해야 합니다.

- 그리고 자바스크립트 파일들은 HTML, CSS 들이 화면에 보여지고 난 후에 사용자가 자바스크립트 관련 이벤트를 사용해야 실행이 됩니다. 여기서 이벤트는 브라우저에 웹 페이지가 렌더링 된 이후의 과정도 포함 됩니다.

4. 이는 3번이 일어나는 시점에서 같이 일어나는데 사용자의 요청을 서버 측에서 받으면 정적 웹 페이지 뿐만 아니라 데이터, Web Socket, Security 등의 정보를 제공해야 합니다. 이는 백엔드 서비스 단위에서 순식간 CRUD 과정을 거치고 다시 클라이언트에게 보여지기 위해 동기적인 렌더링 과정을 거쳐 최종 웹 페이지를 완성합니다.

5. 웹 페이지에 대한 요청이 최종 완료 되면 HTTP Status 를 200 OK 로 알립니다. HTTP Status 번호는 200 번대는 성공, 300 번대는 리다이렉트, 400번대는 에러, 500번대는 서버 오류입니다.

## Asynchronous Request With AJAX At Web

위에서 작성한 방법이 이전에 Web 페이지를 불러오는 정형적인 방법입니다. 하지만 AJAX 를 사용하는 이점이 무엇일까요?

예를 들어 사용자가 회원 가입을 하는데 우편 번호를 입력 합니다. 그리고 이를 검색하기 위한 API 가 있는데 회원 가입 폼에 검색창에서 제공한다고 가정하겠습니다.

그러면 사용자가 사는 지역에 대한 검색을 할 때 요청에 대한 결과를 받기 위한 렌더링 과정이 실행 됩니다. 

여기서 사용자가 작성한 Form 에 대하여 저장되는 기능이 있더라도, 회원 가입 Form 을 위한 렌더링 과정을 또 거치는 것은 자원 낭비입니다.

오프라인에서 쉽게 생각하면 보고서를 작성하는데 갑자기 교수님이 보고서의 형식을 바꾸는 것과 같습니다.

이러한 일을 방지하기 위해 AJAX 를 사용하는데 대략 어떤 과정으로 일어나는지 정리하면 아래와 같습니다.

1. 웹 서비스에 필요한 정적 웹 페이지, CSS, JavaScript, 미디어 파일들을 모두 불러왔습니다. 그 중에서 사용자가 AJAX 요청이 포함된 UI 이벤트를 실행합니다. 이 이벤트는 클릭이나 키보드 입력 등 다양합니다.

2. 그러면 사용자가 실행한 비동기 이벤트에 대하여, JavaScript 엔진(크롬은 V8, Edge 는 차크라, 사파리는 웹킷) 이 AJAX 요청을 실행하고 HTTP 응답을 받아 옵니다.

3. AJAX 에서 데이터를 받아오기 위해 XML, JSON 포맷을 사용하는데 이를 제공하기 위해 서버 측에서는 RESTful API 를 사용하거나 AJAX 속의 HTML 등을 이용하여 클라이언트 측에 보내줍니다. 참고로 JSON 포맷을 보내기 위한 직렬화 과정(Serialize) 은 서버에서 이뤄지고, 역직렬화 과정(Deserialize, 즉 자바스크립트에서 객체로 읽는 거)은 클라이언트에서 이뤄집니다.

4. 데이터를 다 받아오면 현재 창에 있는 페이지는 그대로 내비 두고, JSON 데이터에 대한 렌더링 프레임워크나 라이브러리에서 이에 따른 렌더링 과정을 거치고, AJAX 를 이용한 HTML 문서는 그 자리에 해당되는 곳에서 보여주는 것으로 끝이 납니다. 참고로 AJAX 에 응답 받은 HTML 는 `iframe` 태그를 이용해서 보여주는 것이 대부분입니다.

## Author

- 강인성([tails5555](https://github.com/tails5555))